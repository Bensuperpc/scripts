version: '3.7'

services:
  web:
    image: itzg/rcon
    environment:
      RWA_USERNAME: admin
      RWA_PASSWORD: admin
      RWA_ADMIN: "TRUE"
      # is referring to the hostname of 'mc' compose service below
      RWA_RCON_HOST: mc
      # needs to match the password configured for the container, which is 'minecraft' by default
      RWA_RCON_PASSWORD: minecraft
    ports:
      - 4326:4326
      - 4327:4327
  mc:
    image: itzg/minecraft-server
    ports:
      - 25565:25565
    environment:
      EULA: "true"
      ONLINE_MODE: "true"
      SERVER_PORT: "25565"
      TYPE: PAPER
      MOTD: "My Server" 
      VERSION: "1.16.5"
      MEMORY: 4G
      EXEC_DIRECTLY: "false"
      BUILD_FROM_SOURCE: "false"
      SPIGET_RESOURCES: "9089,34315"
      USE_AIKAR_FLAGS: "true"
      USE_LARGE_PAGES: "false"
      OPS: Bensuperpc
      ENABLE_AUTOPAUSE: "true"
      OVERRIDE_SERVER_PROPERTIES: "true"
      MAX_TICK_TIME: "-1"
      GUI: "false"
      LEVEL: world
      LEVEL_TYPE=: "default"
      VIEW_DISTANCE: "10"
      ENABLE_COMMAND_BLOCK: "true"
      PVP: "true"
      DIFFICULTY: hard
      ALLOW_NETHER: "true"
    volumes:
    - mc:/data
  backups:
    image: itzg/mc-backup
    environment:
      BACKUP_INTERVAL: "2h"
      INITIAL_DELAY: "5m"
      PRUNE_BACKUPS_DAYS: "7"
      # instead of network_mode below, could declare RCON_HOST
      # RCON_HOST: mc
    volumes:
    # mount the same volume used by server, but read-only
    - mc:/data:ro
    # use a host attached directory so that it in turn can be backed up
    # to external/cloud storage
    - ./mc-backups:/backups
    # share network namespace with server to simplify rcon access
    network_mode: "service:mc"

volumes:
  mc: {}
